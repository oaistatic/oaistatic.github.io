(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9457],{85652:function(e,s,t){"use strict";t.r(s),t.d(s,{__N_SSP:function(){return B},default:function(){return X}});var n=t(89691),i=t(25660),l=t(22433),r=t(7557),o=t(16244),a=t(28144),c=t(43383),d=t(25991),u=t(84297),m=t(8402),x=t(49508),h=t(28373),f=t(99715),g=t(61236),j=t(10518),p=t(12366),v=t(70079),y=t(68498),b=t(84692),w=t(35250);let z=e=>{let{gizmoId:s,limit:t,cursor:n}=e;return(0,g.a)({queryFn:async()=>x.U.listVersions({gizmoId:s}),queryKey:["gizmo","versions",{gizmoId:s,limit:t,cursor:n}]})},N=(0,v.memo)(function(e){let{gizmoId:s,onSelectVersion:t}=e,{value:n}=(0,j.sB)(j.tz.GizmoVersionHistory);return s&&n?(0,w.jsx)(_,{gizmoId:s,onSelectVersion:t}):null});function _(e){let{gizmoId:s,onSelectVersion:t}=e,n=(0,p.useRouter)(),{data:i}=z({gizmoId:s}),l=i?i.items.reduce((e,s)=>{let t=new Date(s.updated_at),n="".concat(t.getFullYear(),"-").concat(t.getMonth()+1,"-").concat(t.getDate());return e[n]||(e[n]=[]),e[n].push(s),e},{}):null,r=e=>{n.push("/g/".concat(s,"/view?version=").concat(e))};return l?(0,w.jsx)("div",{className:"relative h-full w-screen max-w-2xs",children:(0,w.jsx)("div",{className:"flex h-full max-w-2xs flex-col overflow-y-scroll bg-token-sidebar-surface-primary py-6 shadow-xl",children:(0,w.jsx)("div",{className:"relative flex-1 px-4 sm:px-6",children:Object.keys(l).map((e,s)=>{let n=l[e];return(0,w.jsx)(k,{date:e,entries:n,onSelectVersion:t,onRestoreVersion:r},s)})})})}):null}function k(e){let{date:s,entries:t,onSelectVersion:n,onRestoreVersion:i}=e;return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("div",{className:"border-b border-token-border-medium py-2 font-medium uppercase text-token-text-secondary",children:(0,w.jsx)(y.Ji,{value:s,dateStyle:"medium"})}),(0,w.jsx)("div",{className:"flex flex-col space-y-2",children:t.map((e,s)=>(0,w.jsxs)("div",{className:"flex flex-row items-center justify-between border-b border-token-border-medium",onClick:()=>n(e.version),children:[(0,w.jsx)("span",{className:"grow p-2 hover:cursor-pointer hover:bg-token-sidebar-surface-tertiary",children:(0,w.jsx)(y.Ji,{value:e.updated_at,timeStyle:"short"})}),(0,w.jsx)(C,{onRestoreVersion:()=>{i(e.version)}})]},s))})]})}function C(e){let{onRestoreVersion:s}=e;return(0,w.jsx)(w.Fragment,{children:(0,w.jsxs)(f.fC,{children:[(0,w.jsx)(f.xz,{asChild:!0,children:(0,w.jsx)("button",{color:"neutral",className:"rounded-lg px-3 py-2 text-token-text-primary duration-100 ease-in hover:bg-token-sidebar-surface-tertiary active:scale-[0.9]",children:(0,w.jsx)(m.Yr,{className:"icon-md"})})}),(0,w.jsx)(f.Uv,{children:(0,w.jsx)(f.VY,{className:"flex min-w-[100px] max-w-xs flex-col rounded-xl border border-gray-400 bg-token-main-surface-primary shadow-lg dark:border-gray-700",sideOffset:7,children:(0,w.jsxs)(h.UA,{className:"items-center",disabled:!1,onClick:s,children:[(0,w.jsx)(m.Nt,{className:"icon-md"}),(0,w.jsx)(b.Z,{id:"gizmoVersionHistory.restoreVersionLabel",defaultMessage:"Restore this version"})]})})})]})})}var R=t(39496),I=t(61888);let V=e=>{let{gizmoId:s,version:t}=e;return(0,g.a)({queryFn:async()=>x.U.getVersion({gizmoId:s,version:t}),queryKey:["gizmo","version",{gizmoId:s,version:t}]})},M=(e,s)=>"/gpts/editor/".concat(e,"?version=").concat(s);function O(e){var s;let{gizmoId:t}=e,{0:r,1:o}=(0,v.useState)(null),a=(0,p.useRouter)(),{data:c}=(0,n.b9)(t),d=null==c||null===(s=c.gizmo.current_user_permission)||void 0===s?void 0:s.can_write,u=(0,n.YR)(),{0:x,1:f}=(0,v.useState)(!1),g=()=>{r?a.push(M(t,r)):a.push((0,R.AA)(t))};return(0,w.jsxs)("div",{className:"flex h-screen w-full flex-col items-center",children:[(0,w.jsx)("div",{className:"relative flex h-16 w-full items-center justify-between gap-2 border-b border-token-border-medium px-3",children:c&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{className:"flex cursor-pointer items-center gap-2",onClick:()=>a.back(),children:[(0,w.jsx)(m.L7,{className:"icon-lg"}),(0,w.jsx)("div",{className:"font-medium",children:d?(0,w.jsx)(b.Z,{id:"gizmoReadOnly.versionHistoryTitle",defaultMessage:"Version History"}):(0,w.jsx)(b.Z,{id:"gizmoReadOnly.configurationTitle",defaultMessage:"Configuration"})})]}),(0,w.jsx)("div",{className:"mr-4 flex items-center gap-2",children:d?(0,w.jsx)(h.cY,{color:"light",onClick:()=>{r&&r!==c.gizmo.live_version&&c.tools.find(e=>{var s;return e.type===i.qK.JIT_PLUGIN&&(null===(s=e.metadata.auth)||void 0===s?void 0:s.type)!==l.Jv.None})?f(!0):g()},children:"Restore this version"}):(0,w.jsx)(h.cY,{color:"light",loading:u.isPending,onClick:async()=>{let e=await u.mutateAsync({gizmoId:t});e.gizmo.id&&a.push("/gpts/editor/".concat(e.gizmo.id))},children:"Duplicate"})})]})}),(0,w.jsxs)("div",{className:"flex h-full w-full items-center",children:[d&&(0,w.jsx)(N,{gizmoId:t,onSelectVersion:e=>{o(e)}}),(0,w.jsx)(T,{gizmoId:t,version:r})]}),x&&(0,w.jsx)(S,{onClose:()=>{f(!1)},onContinue:g})]})}function S(e){let{onClose:s,onContinue:t}=e,{0:n,1:i}=(0,v.useState)(!1);return(0,w.jsx)(o.Z,{isOpen:!0,onClose:s,type:"warning",showCloseButton:!0,title:(0,w.jsx)(b.Z,{id:"gizmoReadOnly.authModalWarningTitle",defaultMessage:"Reset Authentication for Custom Actions"}),primaryButton:(0,w.jsx)(r.z,{onClick:()=>{i(!0),t()},loading:n,color:"light",children:(0,w.jsx)(b.Z,{id:"gizmoReadOnly.authModalContinueButton",defaultMessage:"Continue"})}),secondaryButton:(0,w.jsx)(r.z,{onClick:s,color:"neutral",children:(0,w.jsx)(b.Z,{id:"gizmoReadOnly.authModalCancelButton",defaultMessage:"Cancel"})}),size:"normal",children:(0,w.jsx)(b.Z,{id:"gizmoReadOnly.authModalWarningBody",defaultMessage:"Restoring this version will reset authentication of your custom actions. You may need to reconfigure each custom action afterwards."})})}function T(e){var s,t,n,l;let{gizmoId:r,version:o}=e,{data:m}=V({gizmoId:r,version:o}),{0:x,1:h}=(0,v.useState)(null);if(!m)return null;let f=m.tools.filter(e=>e.type===i.qK.JIT_PLUGIN);return(0,w.jsx)("div",{className:"flex max-h-[80vh] flex-grow justify-center overflow-y-auto",children:(0,w.jsxs)("div",{className:"flex w-full max-w-2xl flex-col text-sm",children:[(0,w.jsx)(d.hj,{className:"self-center",children:(0,w.jsx)(c.Z,{src:m.gizmo.display.profile_picture_url,isFirstParty:!1,className:"h-12 w-12"})}),(0,w.jsxs)(d.hj,{children:[(0,w.jsx)(d.lX,{label:"Name"}),(0,w.jsx)(d.yt,{type:"text",value:null!==(s=m.gizmo.display.name)&&void 0!==s?s:"",disabled:!0,className:"bg-token-main-surface-secondary"})]}),(0,w.jsxs)(d.hj,{children:[(0,w.jsx)(d.lX,{label:"Description"}),(0,w.jsx)(d.yt,{type:"text",value:null!==(t=m.gizmo.display.description)&&void 0!==t?t:"",disabled:!0,className:"bg-token-main-surface-secondary"})]}),(0,w.jsxs)(d.hj,{children:[(0,w.jsx)(d.lX,{label:"Instructions"}),(0,w.jsx)(d.B1,{className:"resize-none bg-token-main-surface-secondary",rows:8,value:null!==(n=m.gizmo.instructions)&&void 0!==n?n:"",disabled:!0})]}),m.gizmo.display.prompt_starters&&m.gizmo.display.prompt_starters.length>0&&(0,w.jsxs)(d.hj,{children:[(0,w.jsx)(d.lX,{label:"Conversation starters"}),m.gizmo.display.prompt_starters.map((e,s)=>(0,w.jsx)(d.yt,{type:"text",value:e,disabled:!0,className:"resize-none bg-token-main-surface-secondary"},s))]}),m.files&&m.files.length>0&&(0,w.jsxs)(d.hj,{children:[(0,w.jsx)(d.lX,{label:"Knowledge"}),m.files.map((e,s)=>(0,w.jsx)(a.Z,{file:e.name,fileId:e.id},s))]}),(0,w.jsxs)(d.hj,{children:[(0,w.jsx)(d.lX,{label:"Capabilities"}),(0,w.jsx)(u.W,{enabledTools:m.tools,onEnabledToolsChange:I.noop})]}),f&&f.length>0&&(0,w.jsxs)(d.hj,{children:[(0,w.jsx)(d.lX,{label:"Actions"}),f.map((e,s)=>(0,w.jsx)(d.r,{isDisabled:!0,actionTool:e,onShowActionsEditor:()=>{(null==x?void 0:x.metadata.action_id)===e.metadata.action_id?h(null):h(e)}},s)),x&&(0,w.jsx)("textarea",{readOnly:!0,value:null!==(l=x.metadata.raw_spec)&&void 0!==l?l:"",className:"mb-16 block h-96 w-full border-t-0 border-token-main-surface-tertiary bg-transparent p-2 font-mono text-xs text-token-text-primary"})]})]})})}var Z=t(24668),B=!0;function X(){var e,s;let t=(0,Z.t)(),i=(0,p.useRouter)(),l=null!==(e=null===(s=i.query)||void 0===s?void 0:s.gizmoId)&&void 0!==e?e:"",r=(0,n.CR)(l),{value:o}=(0,j.sB)(j.tz.GizmoVersionHistory);return(0,v.useEffect)(()=>{null!=t&&t.isFree()&&i.push("/")},[t,i]),o?(0,w.jsx)(O,{gizmoId:r}):null}},41510:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/g/[gizmoId]/view",function(){return t(85652)}])}},function(e){e.O(0,[4736,2888,9774,179],function(){return e(e.s=41510)}),_N_E=e.O()}]);
//# sourceMappingURL=view-529cae1a470f0c57.js.map